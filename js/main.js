let restaurants,neighborhoods,cuisines;var map,markers=[];document.addEventListener('DOMContentLoaded',()=>{fetchNeighborhoods(),fetchCuisines()});const fetchNeighborhoods=()=>{DBHelper.fetchNeighborhoods((a,b)=>{a?console.error(a):(self.neighborhoods=b,fillNeighborhoodsHTML())})},fillNeighborhoodsHTML=(a=self.neighborhoods)=>{const b=document.getElementById('neighborhoods-select');a.forEach(c=>{const d=document.createElement('option');d.innerHTML=c,d.value=c,b.append(d)})},fetchCuisines=()=>{DBHelper.fetchCuisines((a,b)=>{a?console.error(a):(self.cuisines=b,fillCuisinesHTML())})},fillCuisinesHTML=(a=self.cuisines)=>{const b=document.getElementById('cuisines-select');a.forEach(c=>{const d=document.createElement('option');d.innerHTML=c,d.value=c,b.append(d)})},initMap=()=>{self.map=new google.maps.Map(document.getElementById('map'),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants(),google.maps.event.addDomListener(window,'load',addIframeTitle)},initStaticMap=()=>{let a=document.getElementById('staticMap');a.onmouseover=initMap};function addIframeTitle(){document.querySelector('iframe').title='map of the area'}const updateRestaurants=()=>{const a=document.getElementById('cuisines-select'),b=document.getElementById('neighborhoods-select'),c=document.getElementById('favourites-select'),d=a.selectedIndex,f=b.selectedIndex,g=a[d].value,h=b[f].value,j=c.checked;DBHelper.fetchRestaurantByCuisineAndNeighborhood(g,h,j,(k,l)=>{k?console.error(k):(resetRestaurants(l),fillRestaurantsHTML())})},resetRestaurants=a=>{self.restaurants=[];const b=document.getElementById('restaurants-list');b.innerHTML='',self.markers.forEach(c=>c.setMap(null)),self.markers=[],self.restaurants=a},fillRestaurantsHTML=(a=self.restaurants)=>{const b=document.getElementById('restaurants-list');let c=0;a.forEach(d=>{1>c?b.append(createRestaurantHTML(d)):b.append(createLazyRestaurantHTML(d)),c++}),addMarkersToMap(),createLazyListener(),initModal(),initFav()},createRestaurantHTML=a=>{const b=document.createElement('li');b.tabIndex=0;const c=document.createElement('picture'),d=document.createElement('source');d.srcset='./img/'+DBHelper.restaurantId(a)+'-small_x2.webp 2x, ./img/'+DBHelper.restaurantId(a)+'-small.webp',d.type='image/webp',c.append(d);const f=document.createElement('source');f.srcset='./img/'+DBHelper.restaurantId(a)+'-small_x2.jpg 2x, ./img/'+DBHelper.restaurantId(a)+'-small.jpg',f.type='image/jpeg',c.append(f);const g=document.createElement('img');g.className='restaurant-img',g.src='./img/'+DBHelper.restaurantId(a)+'-small.jpg';const h=a.name;g.alt=`photo of ${h} restaurant`,c.append(g),b.append(c);const j=document.createElement('h3');j.innerHTML=a.name,b.append(j);const k=document.createElement('p');k.innerHTML=a.neighborhood,b.append(k);const l=document.createElement('p');l.innerHTML=a.address,b.append(l);const n=document.createElement('a');n.innerHTML='View Details',n.setAttribute('aria-label','View Details about '+a.name),n.href=DBHelper.urlForRestaurant(a),n.className='linkBtn btn',b.append(n);const o=document.createElement('button');if(o.innerHTML='Review',o.setAttribute('aria-label','Review '+a.name),o.className='reviewBtn btn',o.dataset.restaurant=a.name,o.dataset.restaurantId=a.id,b.append(o),!0==a.is_favorite||'true'==a.is_favorite)var p='favBtn heart';else var p='favBtn emptyHeart';const q=document.createElement('img');return q.alt='Select Favourite',q.className=p,q.dataset.restaurantId=a.id,b.append(q),b},createLazyRestaurantHTML=a=>{const b=document.createElement('li');b.tabIndex=0;const c=document.createElement('picture'),d=document.createElement('source');d.srcset='',d.dataset.srcset='./img/'+DBHelper.restaurantId(a)+'-small_x2.webp 2x, ./img/'+DBHelper.restaurantId(a)+'-small.webp',d.type='image/webp',d.className='lazy',c.append(d);const f=document.createElement('source');f.srcset='',f.dataset.srcset='./img/'+DBHelper.restaurantId(a)+'-small_x2.jpg 2x, ./img/'+DBHelper.restaurantId(a)+'-small.jpg',f.type='image/jpeg',f.className='lazy',c.append(f);const g=document.createElement('img');g.className='restaurant-img lazy',g.src='',g.dataset.src='./img/'+DBHelper.restaurantId(a)+'-small.jpg';const h=a.name;g.alt=`photo of ${h} restaurant`,c.append(g),b.append(c);const j=document.createElement('h3');j.innerHTML=a.name,b.append(j);const k=document.createElement('p');k.innerHTML=a.neighborhood,b.append(k);const l=document.createElement('p');l.innerHTML=a.address,b.append(l);const n=document.createElement('a');n.innerHTML='View Details',n.setAttribute('aria-label','View Details about '+a.name),n.href=DBHelper.urlForRestaurant(a),n.className='linkBtn btn',b.append(n);const o=document.createElement('button');if(o.innerHTML='Review',o.setAttribute('aria-label','Review '+a.name),o.className='reviewBtn btn',o.dataset.restaurant=a.name,o.dataset.restaurantId=a.id,b.append(o),!0==a.is_favorite||'true'==a.is_favorite)var p='favBtn heart';else var p='favBtn emptyHeart';const q=document.createElement('img');return q.alt='Select Favourite',q.className=p,q.dataset.restaurantId=a.id,b.append(q),b},addMarkersToMap=(a=self.restaurants)=>{a.forEach(b=>{const c=DBHelper.mapMarkerForRestaurant(b,self.map);google.maps.event.addListener(c,'click',()=>{window.location.href=c.url}),self.markers.push(c)})},createLazyListener=()=>{var a=[].slice.call(document.querySelectorAll('img.lazy')),b=[].slice.call(document.querySelectorAll('source.lazy'));if('IntersectionObserver'in window){let c=new IntersectionObserver(function(f){f.forEach(function(h){if(h.isIntersecting){let j=h.target;j.src=j.dataset.src,j.classList.remove('lazy'),c.unobserve(j)}})}),d=new IntersectionObserver(function(f){f.forEach(function(h){if(h.isIntersecting){let j=h.target;j.srcset=j.dataset.srcset,j.classList.remove('lazy'),c.unobserve(j)}})});a.forEach(function(f){c.observe(f)}),b.forEach(function(f){d.observe(f)})}};function initModal(){var a=document.getElementById('reviewModal'),b=document.getElementsByClassName('close'),c=function(g){g.preventDefault(),a.style.display='none'};for(let g of b)g.addEventListener('click',c,!1);window.onclick=function(g){g.target==a&&(a.style.display='none')};var d=document.getElementsByClassName('reviewBtn'),f=function(g){g.preventDefault();var h=document.getElementById('reviewHeader');h.innerHTML='Submit a review for: <span class=\'formTitle\'>'+g.target.dataset.restaurant+'</span>',h.dataset.restaurantId=g.target.dataset.restaurantId,a.style.display='block'};for(let g of d)g.addEventListener('click',f,!1)}function initFav(){var a=document.getElementsByClassName('favBtn');for(let b of a)b.addEventListener('click',function(){var c=b.classList;if(b.classList.toggle('emptyHeart'),b.classList.toggle('heart'),'heart'==c[1])var d=!0;else var d=!1;var f=b.dataset.restaurantId;let g=DBHelper.openDatabase();DBHelper.postData(`http://localhost:1337/restaurants/${f}/?is_favorite=${d}`,`PUT`).then(h=>DBHelper.dbUpdate(h,g)).catch(h=>console.log(h))})}function initShowFav(){var a=document.getElementById('favourites-select');a.addEventListener('click',function(){a.parentElement.classList.toggle('checked'),updateRestaurants()})}if(window.onload=function(){initShowFav(),initStaticMap(),updateRestaurants()},'serviceWorker'in navigator&&window.addEventListener('load',function(){navigator.serviceWorker.register('./sw.js').then(function(a){console.log('ServiceWorker registration successful with scope: ',a.scope)},function(a){console.log('ServiceWorker registration failed: ',a)})}),window.addEventListener('online',function(){navigator.serviceWorker.ready.then(function(b){return b.sync.register('processReviews')})},!1),'serviceWorker'in navigator)navigator.serviceWorker.ready.then(function(a){var b=document.querySelector('#reviewForm');b.addEventListener('submit',function(c){c.preventDefault;try{if(''==b.querySelector('#name').value)return alert('Please enter your name'),!1;if(''==b.querySelector('#review').value)return alert('Please enter your review'),!1;var d=document.getElementById('reviewModal');let h=document.getElementsByName('rating');for(var f=0,g=h.length;f<g;f++)if(h[f].checked){score=h[f].value;break}let j=document.getElementById('reviewHeader').dataset.restaurantId,k={restaurant_id:j,name:b.querySelector('#name').value,rating:score,comments:b.querySelector('#review').value};d.style.display='none';let l=DBHelper.openTempReviewDatabase();DBHelper.dbTempReviewStore(k,l).then(()=>{a.sync.register('processReviews').then(()=>{console.log('Sync Registered'),b.reset()})})}catch(h){throw new Error(h.message)}})});else{console.log('Service workers are not supported.');var form=document.querySelector('#reviewForm');form.addEventListener('submit',function(a){a.preventDefault;try{if(''==form.querySelector('#name').value)return alert('Please enter your name'),!1;if(''==form.querySelector('#review').value)return alert('Please enter your review'),!1;var b=document.getElementById('reviewModal');let f=document.getElementsByName('rating');for(var c=0,d=f.length;c<d;c++)if(f[c].checked){score=f[c].value;break}let g=document.getElementById('reviewHeader').dataset.restaurantId,h={restaurant_id:g,name:form.querySelector('#name').value,rating:score,comments:form.querySelector('#review').value};b.style.display='none',DBHelper.postData(`http://localhost:1337/reviews/`,`POST`,review),form.reset()}catch(f){throw new Error(f.message)}})}