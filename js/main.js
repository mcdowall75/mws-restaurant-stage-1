'use strict';var restaurants,neighborhoods,cuisines,map,markers=[];document.addEventListener('DOMContentLoaded',function(){fetchNeighborhoods(),fetchCuisines()});var fetchNeighborhoods=function(){DBHelper.fetchNeighborhoods(function(a,b){a?console.error(a):(self.neighborhoods=b,fillNeighborhoodsHTML())})},fillNeighborhoodsHTML=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:self.neighborhoods,b=document.getElementById('neighborhoods-select');a.forEach(function(c){var d=document.createElement('option');d.innerHTML=c,d.value=c,b.append(d)})},fetchCuisines=function(){DBHelper.fetchCuisines(function(a,b){a?console.error(a):(self.cuisines=b,fillCuisinesHTML())})},fillCuisinesHTML=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:self.cuisines,b=document.getElementById('cuisines-select');a.forEach(function(c){var d=document.createElement('option');d.innerHTML=c,d.value=c,b.append(d)})},initMap=function(){self.map=new google.maps.Map(document.getElementById('map'),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants(),google.maps.event.addDomListener(window,'load',addIframeTitle)},initStaticMap=function(){var a=document.getElementById('staticMap');a.onmouseover=initMap};function addIframeTitle(){document.querySelector('iframe').title='map of the area'}var updateRestaurants=function(){var a=document.getElementById('cuisines-select'),b=document.getElementById('neighborhoods-select'),c=document.getElementById('favourites-select'),d=a.selectedIndex,f=b.selectedIndex,g=a[d].value,h=b[f].value,j=c.checked;DBHelper.fetchRestaurantByCuisineAndNeighborhood(g,h,j,function(k,l){k?console.error(k):(resetRestaurants(l),fillRestaurantsHTML())})},resetRestaurants=function(a){self.restaurants=[];var b=document.getElementById('restaurants-list');b.innerHTML='',self.markers.forEach(function(c){return c.setMap(null)}),self.markers=[],self.restaurants=a},fillRestaurantsHTML=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:self.restaurants,b=document.getElementById('restaurants-list'),c=0;a.forEach(function(d){1>c?b.append(createRestaurantHTML(d)):b.append(createLazyRestaurantHTML(d)),c++}),addMarkersToMap(),createLazyListener(),initModal(),initFav()},createRestaurantHTML=function(a){var c=document.createElement('li');c.tabIndex=0;var d=document.createElement('picture'),f=document.createElement('source');f.srcset='./img/'+DBHelper.restaurantId(a)+'-small_x2.webp 2x, ./img/'+DBHelper.restaurantId(a)+'-small.webp',f.type='image/webp',d.append(f);var g=document.createElement('source');g.srcset='./img/'+DBHelper.restaurantId(a)+'-small_x2.jpg 2x, ./img/'+DBHelper.restaurantId(a)+'-small.jpg',g.type='image/jpeg',d.append(g);var h=document.createElement('img');h.className='restaurant-img',h.src='./img/'+DBHelper.restaurantId(a)+'-small.jpg';var j=a.name;h.alt='photo of '+j+' restaurant',d.append(h),c.append(d);var k=document.createElement('h3');k.innerHTML=a.name,c.append(k);var l=document.createElement('p');l.innerHTML=a.neighborhood,c.append(l);var n=document.createElement('p');n.innerHTML=a.address,c.append(n);var o=document.createElement('a');o.innerHTML='View Details',o.setAttribute('aria-label','View Details about '+a.name),o.href=DBHelper.urlForRestaurant(a),o.className='linkBtn btn',c.append(o);var p=document.createElement('button');if(p.innerHTML='Review',p.setAttribute('aria-label','Review '+a.name),p.className='reviewBtn btn',p.dataset.restaurant=a.name,p.dataset.restaurantId=a.id,c.append(p),!0==a.is_favorite||'true'==a.is_favorite)var b='favBtn heart';else var b='favBtn emptyHeart';var q=document.createElement('img');return q.alt='Select Favourite',q.className=b,q.dataset.restaurantId=a.id,c.append(q),c},createLazyRestaurantHTML=function(a){var c=document.createElement('li');c.tabIndex=0;var d=document.createElement('picture'),f=document.createElement('source');f.srcset='',f.dataset.srcset='./img/'+DBHelper.restaurantId(a)+'-small_x2.webp 2x, ./img/'+DBHelper.restaurantId(a)+'-small.webp',f.type='image/webp',f.className='lazy',d.append(f);var g=document.createElement('source');g.srcset='',g.dataset.srcset='./img/'+DBHelper.restaurantId(a)+'-small_x2.jpg 2x, ./img/'+DBHelper.restaurantId(a)+'-small.jpg',g.type='image/jpeg',g.className='lazy',d.append(g);var h=document.createElement('img');h.className='restaurant-img lazy',h.src='',h.dataset.src='./img/'+DBHelper.restaurantId(a)+'-small.jpg';var j=a.name;h.alt='photo of '+j+' restaurant',d.append(h),c.append(d);var k=document.createElement('h3');k.innerHTML=a.name,c.append(k);var l=document.createElement('p');l.innerHTML=a.neighborhood,c.append(l);var n=document.createElement('p');n.innerHTML=a.address,c.append(n);var o=document.createElement('a');o.innerHTML='View Details',o.setAttribute('aria-label','View Details about '+a.name),o.href=DBHelper.urlForRestaurant(a),o.className='linkBtn btn',c.append(o);var p=document.createElement('button');if(p.innerHTML='Review',p.setAttribute('aria-label','Review '+a.name),p.className='reviewBtn btn',p.dataset.restaurant=a.name,p.dataset.restaurantId=a.id,c.append(p),!0==a.is_favorite||'true'==a.is_favorite)var b='favBtn heart';else var b='favBtn emptyHeart';var q=document.createElement('img');return q.alt='Select Favourite',q.className=b,q.dataset.restaurantId=a.id,c.append(q),c},addMarkersToMap=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:self.restaurants;a.forEach(function(b){var c=DBHelper.mapMarkerForRestaurant(b,self.map);google.maps.event.addListener(c,'click',function(){window.location.href=c.url}),self.markers.push(c)})},createLazyListener=function(){var a=[].slice.call(document.querySelectorAll('img.lazy')),b=[].slice.call(document.querySelectorAll('source.lazy'));if('IntersectionObserver'in window){var c=new IntersectionObserver(function(f){f.forEach(function(h){if(h.isIntersecting){var j=h.target;j.src=j.dataset.src,j.classList.remove('lazy'),c.unobserve(j)}})}),d=new IntersectionObserver(function(f){f.forEach(function(h){if(h.isIntersecting){var j=h.target;j.srcset=j.dataset.srcset,j.classList.remove('lazy'),c.unobserve(j)}})});a.forEach(function(f){c.observe(f)}),b.forEach(function(f){d.observe(f)})}};function initModal(){var a=document.getElementById('reviewModal'),b=document.getElementsByClassName('close'),c=function(o){o.preventDefault(),a.style.display='none'},_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var h,j,g=b[Symbol.iterator]();!(_iteratorNormalCompletion=(h=g.next()).done);_iteratorNormalCompletion=!0)j=h.value,j.addEventListener('click',c,!1)}catch(o){_didIteratorError=!0,_iteratorError=o}finally{try{!_iteratorNormalCompletion&&g.return&&g.return()}finally{if(_didIteratorError)throw _iteratorError}}window.onclick=function(o){o.target==a&&(a.style.display='none')};var d=document.getElementsByClassName('reviewBtn'),f=function(o){o.preventDefault();var p=document.getElementById('reviewHeader');p.innerHTML='Submit a review for: <span class=\'formTitle\'>'+o.target.dataset.restaurant+'</span>',p.dataset.restaurantId=o.target.dataset.restaurantId,a.style.display='block'},_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var l,n,k=d[Symbol.iterator]();!(_iteratorNormalCompletion2=(l=k.next()).done);_iteratorNormalCompletion2=!0)n=l.value,n.addEventListener('click',f,!1)}catch(o){_didIteratorError2=!0,_iteratorError2=o}finally{try{!_iteratorNormalCompletion2&&k.return&&k.return()}finally{if(_didIteratorError2)throw _iteratorError2}}}function initFav(){var a=document.getElementsByClassName('favBtn'),_iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var c,_loop=function(){var d=c.value;d.addEventListener('click',function(){var f=d.classList;if(d.classList.toggle('emptyHeart'),d.classList.toggle('heart'),'heart'==f[1])var g=!0;else var g=!1;var h=d.dataset.restaurantId,j=DBHelper.openDatabase();DBHelper.postData('http://localhost:1337/restaurants/'+h+'/?is_favorite='+g,'PUT').then(function(k){return DBHelper.dbUpdate(k,j)}).catch(function(k){return console.log(k)})})},b=a[Symbol.iterator]();!(_iteratorNormalCompletion3=(c=b.next()).done);_iteratorNormalCompletion3=!0)_loop()}catch(d){_didIteratorError3=!0,_iteratorError3=d}finally{try{!_iteratorNormalCompletion3&&b.return&&b.return()}finally{if(_didIteratorError3)throw _iteratorError3}}}function initShowFav(){var a=document.getElementById('favourites-select');a.addEventListener('click',function(){a.parentElement.classList.toggle('checked'),updateRestaurants()})}function status(){function a(){var d=navigator.onLine?'online':'offline';b.className=d,b.alt='Network status '+d}var b=document.getElementById('status');window.addEventListener('online',a),window.addEventListener('offline',a)}if(window.onload=function(){initShowFav(),initStaticMap(),updateRestaurants(),status()},'serviceWorker'in navigator&&window.addEventListener('load',function(){navigator.serviceWorker.register('./sw.js').then(function(a){console.log('ServiceWorker registration successful with scope: ',a.scope)},function(a){console.log('ServiceWorker registration failed: ',a)})}),window.addEventListener('online',function(){navigator.serviceWorker.ready.then(function(b){return b.sync.register('processReviews')})},!1),'serviceWorker'in navigator)navigator.serviceWorker.ready.then(function(a){var b=document.querySelector('#reviewForm');b.addEventListener('submit',function(c){c.preventDefault;try{if(''==b.querySelector('#name').value)return alert('Please enter your name'),!1;if(''==b.querySelector('#review').value)return alert('Please enter your review'),!1;for(var d=document.getElementById('reviewModal'),h=document.getElementsByName('rating'),f=0,g=h.length;f<g;f++)if(h[f].checked){score=h[f].value;break}var j=document.getElementById('reviewHeader').dataset.restaurantId,k={restaurant_id:j,name:b.querySelector('#name').value,rating:score,comments:b.querySelector('#review').value};d.style.display='none';var l=DBHelper.openTempReviewDatabase();DBHelper.dbTempReviewStore(k,l).then(function(){a.sync.register('processReviews').then(function(){console.log('Sync Registered'),b.reset()})})}catch(n){throw new Error(n.message)}})});else{console.log('Service workers are not supported.');var form=document.querySelector('#reviewForm');form.addEventListener('submit',function(a){a.preventDefault;try{if(''==form.querySelector('#name').value)return alert('Please enter your name'),!1;if(''==form.querySelector('#review').value)return alert('Please enter your review'),!1;for(var b=document.getElementById('reviewModal'),f=document.getElementsByName('rating'),c=0,d=f.length;c<d;c++)if(f[c].checked){score=f[c].value;break}var g=document.getElementById('reviewHeader').dataset.restaurantId,h={restaurant_id:g,name:form.querySelector('#name').value,rating:score,comments:form.querySelector('#review').value};b.style.display='none',DBHelper.postData('http://localhost:1337/reviews/','POST',review),form.reset()}catch(j){throw new Error(j.message)}})}