'use strict';var _createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,'value'in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function openDatabase(){return navigator.serviceWorker?idb.open('wittr',1,function(a){var b=a.createObjectStore('wittrs',{keyPath:'id'});b.createIndex('by-date','time')}):Promise.resolve()}function openDatabase(){idb.open('restaurants-db',2,function(b){b.objectStoreNames.contains('restaurants')||b.createObjectStore('restaurants')})}var idbrestaurantval={get:function get(a){return dbPromise.then(function(b){return b.transaction('restaurants').objectStore('restaurants').get(a)})},set:function set(a,b){return dbPromise.then(function(c){var d=c.transaction('restaurants','readwrite');return d.objectStore('restaurants').put(b,a),d.complete})},delete:function _delete(a){return dbPromise.then(function(b){var c=b.transaction('restaurants','readwrite');return c.objectStore('restaurants').delete(a),c.complete})},clear:function clear(){return dbPromise.then(function(a){var b=a.transaction('restaurants','readwrite');return b.objectStore('restaurants').clear(),b.complete})},keys:function keys(){return dbPromise.then(function(a){var b=a.transaction('restaurants'),c=[],d=b.objectStore('restaurants');return(d.iterateKeyCursor||d.iterateCursor).call(d,function(e){e&&(c.push(e.restaurant),e.continue())}),b.complete.then(function(){return c})})}},DBHelper=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:'fetchRestaurants',value:function fetchRestaurants(b){var c=new XMLHttpRequest;c.open('GET',a.DATABASE_URL),c.onload=function(){if(200===c.status){var d=JSON.parse(c.responseText);b(null,d)}else{var e='Request failed. Returned status of '+c.status;b(e,null)}},c.send()}},{key:'fetchRestaurantById',value:function fetchRestaurantById(b,c){a.fetchRestaurants(function(d,e){if(d)c(d,null);else{var f=e.find(function(g){return g.id==b});f?c(null,f):c('Restaurant does not exist',null)}})}},{key:'fetchRestaurantByCuisine',value:function fetchRestaurantByCuisine(b,c){a.fetchRestaurants(function(d,e){if(d)c(d,null);else{var f=e.filter(function(g){return g.cuisine_type==b});c(null,f)}})}},{key:'fetchRestaurantByNeighborhood',value:function fetchRestaurantByNeighborhood(b,c){a.fetchRestaurants(function(d,e){if(d)c(d,null);else{var f=e.filter(function(g){return g.neighborhood==b});c(null,f)}})}},{key:'fetchRestaurantByCuisineAndNeighborhood',value:function fetchRestaurantByCuisineAndNeighborhood(b,c,d){a.fetchRestaurants(function(e,f){if(e)d(e,null);else{var g=f;'all'!=b&&(g=g.filter(function(h){return h.cuisine_type==b})),'all'!=c&&(g=g.filter(function(h){return h.neighborhood==c})),d(null,g)}})}},{key:'fetchNeighborhoods',value:function fetchNeighborhoods(b){a.fetchRestaurants(function(c,d){if(c)b(c,null);else{var e=d.map(function(g,h){return d[h].neighborhood}),f=e.filter(function(g,h){return e.indexOf(g)==h});b(null,f)}})}},{key:'fetchCuisines',value:function fetchCuisines(b){a.fetchRestaurants(function(c,d){if(c)b(c,null);else{var e=d.map(function(g,h){return d[h].cuisine_type}),f=e.filter(function(g,h){return e.indexOf(g)==h});b(null,f)}})}},{key:'urlForRestaurant',value:function urlForRestaurant(b){return'./restaurant.html?id='+b.id}},{key:'restaurantId',value:function restaurantId(b){return''+b.id}},{key:'imageUrlForRestaurant',value:function imageUrlForRestaurant(b){return'/img/'+b.id+'-large.webp'}},{key:'mapMarkerForRestaurant',value:function mapMarkerForRestaurant(b,c){var d=new google.maps.Marker({position:b.latlng,title:b.name,url:a.urlForRestaurant(b),map:c,animation:google.maps.Animation.DROP});return d}},{key:'DATABASE_URL',get:function get(){return'http://localhost:'+1337+'/restaurants'}}]),a}();